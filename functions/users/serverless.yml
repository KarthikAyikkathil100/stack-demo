service: StackDemoUsers
frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs18.x
  region: us-east-1
  stage: ${opt:stage}
  versionFunctions: false
  stackName: ${opt:stage}-StackDemoUser

package:
  individually: true


resources:
  Resources:
    F1Role:
      Type: AWS::IAM::Role
      Properties:
        RoleName: ${self:custom.STAGE}-F1Role_S
        AssumeRolePolicyDocument:
          Version: '2012-10-17'
          Statement:
            - Effect: Allow
              Principal:
                Service:
                  - lambda.amazonaws.com 
              Action:
                - sts:AssumeRole
    CloudwatchAccessPolicy:
      Type: AWS::IAM::Policy
      Properties:
        PolicyName: ${self:custom.STAGE}-CloudwatchAccessPolicy_S
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
            - Effect: Allow
              Action:
                - 'logs:CreateLogStream'
                - 'logs:PutLogEvents'
              Resource: '*'
        Roles:
          - !Ref F1Role

custom:
  ACCOUNT_ID: !Ref AWS::AccountId
  REGION: !Ref AWS::Region
  STAGE: ${self:provider.stage}
  APPLICATION: 'StackDemo-Users'


functions:
  F1Function:
    name: ${self:custom.STAGE}-F1Function_S
    runtime: nodejs18.x
    handler: './functions/f1.handler'
    role: 'arn:aws:iam::021891572638:role/masterrole'
    package:
      patterns:
        - 'functions/f1.handler.js'
    events:
      - http:
          path: '/users/f1'
          method: 'get'
          cors: true